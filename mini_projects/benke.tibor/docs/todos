## üöß El≈ëtt√ºnk √°ll√≥ feladatok

### High Priority (üéØ Immediate - 1-2 h√©t)
- [ ] **Citation-level feedback UI**: üëçüëé gombok citation-√∂k√∂n (response-level m√°r k√©sz, citation-level m√©g nincs)
  - Implement√°ci√≥: Minden forr√°s mellett dedik√°lt feedback gombok, k√ºl√∂n API endpoint citation-szint≈± feedback ment√©sre, qdrant metadata friss√≠t√©s (score boost/penalty).
- [ ] **Rerank implementation**: Citation re-ranking feedback-weighted semantic relevancia alapj√°n
  - Implement√°ci√≥: Qdrant keres√©si score kombin√°l√°sa feedback score-ral (weighted average), pozit√≠v feedback ‚Üí score boost, negat√≠v ‚Üí penalty.
- [ ] **Integration tesztek**: Multi-domain RAG + feedback + external APIs end-to-end
  - Implement√°ci√≥: Pytest end-to-end test suite (query ‚Üí retrieval ‚Üí feedback ‚Üí rerank loop), multi-domain test fixtures (IT + HR dokumentumok), coverage target 80%.
  - **Google Drive API**: test_google_drive_client.py (file list, upload, download, search, OAuth flow)
  - **Jira/Confluence API**: Kib≈ëv√≠t√©s test_atlassian_client.py-ban (real API calls opcion√°lis @pytest.mark.integration flag-gel)
  - **End-to-End**: IT query ‚Üí Qdrant retrieval ‚Üí Jira ticket creation workflow teszt

### Medium Priority (üìÖ Short-term - 2-4 h√©t)
- [ ] **Query embedding context scoring**: Feedback aggregation embedding similarity-vel
  - Implement√°ci√≥: Query embedding t√°rol√°sa PostgreSQL-ben feedback mellett, hasonl√≥ k√©rd√©sek (cosine similarity > 0.8) feedback aggreg√°l√°sa, weighted score sz√°m√≠t√°s.
- [ ] **Frontend citation re-ranking**: Live feedback-based result reordering
  - Implement√°ci√≥: Real-time citation lista rendez√©s frontend-en (JavaScript sort) feedback alapj√°n, AJAX endpoint feedback submit ut√°n friss√≠tett sorrend lek√©r√©s√©re.
- [ ] **Szenzit√≠v adatok kisz≈±r√©se**: PII detection a promptb√≥l (email, phone, SSN)
  - Implement√°ci√≥: Regex-based PII detection middleware (email, phone, SSN, credit card patterns), [REDACTED] placeholder behelyettes√≠t√©s vagy request reject.
- [ ] **Rate limiting**: Per-user rate limits (100 req/hour)
  - Implement√°ci√≥: Redis-based rate limiter (user_id key, sliding window), 429 Too Many Requests response, Retry-After header k√ºld√©se.
- [ ] **BM25 sparse vectors**: Lexik√°lis keres√©s t√°mogat√°s (m√°rkanevek, k√≥dok)
  - Implement√°ci√≥: Qdrant sparse vector support, BM25 tokenization (TF-IDF weighted), hybrid search (dense + sparse score kombin√°l√°s) m√°rkanevek/k√≥dok jobb tal√°lat√°hoz.
- [ ] **Prometheus AlertManager**: Alert rules (timeout, cost anomaly, error rate)
  - Implement√°ci√≥: AlertManager konfigur√°l√°s (Prometheus alert rules: latency > 5s, error_rate > 5%, daily_cost > $10), email/Slack notification integr√°ci√≥k.
- [ ] **Semantic Cache**: Vector-based caching (cosine similarity > 0.95 ‚Üí cache hit hasonl√≥ k√©rd√©sekre)
  - Implement√°ci√≥: Query embedding t√°rol√°sa Redis-ben, cosine similarity check minden √∫j query-n√©l. +15-20% cache hit rate hasonl√≥ megfogalmaz√°s√∫ k√©rd√©sekn√©l (pl. "Mi az IP c√≠m?" vs "Mondd meg az IP c√≠met").
- [ ] **Response Caching**: Teljes Summary node v√°lasz cache (TTL: 24h, FAQ-t√≠pus√∫ k√©rd√©sekhez)
  - Implement√°ci√≥: Summary node output cache-el√©se Redis-ben (query hash key). 100% k√∂lts√©g megtakar√≠t√°s ism√©telt azonos k√©rd√©sekn√©l, 95% latency cs√∂kken√©s cache hit eset√©n.
- [ ] **Token Quota System**: Per-user napi token limit (100K/day), 429 Too Many Requests ha t√∫ll√©p√©s
  - Implement√°ci√≥: Redis counter user_id-val (INCR, EXPIRE 24h), middleware check request el≈ëtt. V√©delem t√∫lhaszn√°lat √©s k√∂lts√©g-robban√°s ellen, rate limit integration.

#### üéØ Multi-Tool Agent - F√°zis 1-2 (H√°zi Feladat)

##### F√°zis 1: Reasoning Layer B≈ëv√≠t√©s (1-2 h√©t)
- [ ] **Plan Node**: ExecutionPlan Pydantic model, _plan_node implement√°ci√≥, "Think step-by-step" LLM prompt, graph edge: intent ‚Üí plan ‚Üí retrieval
- [ ] **Chain-of-Thought Prompting**: Update intent_detection/generation/plan prompts CoT-tal, verify step-by-step reasoning tesztekkel
- [ ] **Tool Selection Node**: ToolSelection Pydantic model, _tool_selection_node, LLM d√∂nt√©s (RAG/Jira/Email/Calculation), conditional routing
  - Deliverable: docs/h√°zi feladatok/IMPLEMENTATION_PHASE_1.md, test_plan_node.py, test_tool_selection.py

##### F√°zis 2: Tool Execution Layer (2-3 h√©t)
- [ ] **Tool Registry**: ToolRegistry class (register, get_descriptions, execute), tool schema extraction (type hints ‚Üí JSON), infrastructure/tool_registry.py
- [ ] **Tool Executor Loop**: Iterat√≠v tool execution, per-tool error handling (timeout, retry, fallback), tool results collection & logging
- [ ] **Observation Node**: ObservationOutput model, LLM √©rt√©kel√©s "Do I have enough info?", conditional routing (Generate vs Replan)
- [ ] **Planner Fallback**: Retry node planner fallback, tool fail ‚Üí LLM replan, max replans limit, degradation logic
  - Deliverable: docs/h√°zi feladatok/IMPLEMENTATION_PHASE_2.md, test_tool_executor.py, test_observation.py, test_executor_loop.py

### Low Priority (üîÆ Long-term - 1-3 h√≥nap)

#### Infrastrukt√∫ra & Compliance
- [ ] **Authentication**: API key vagy JWT token auth
  - Implement√°ci√≥: Django REST Framework token authentication (API key header validation) vagy JWT token (OAuth2 flow), user_id k√∂t√©s minden requesthez.
- [ ] **Audit logging**: Compliance log minden query-hez
  - Implement√°ci√≥: Structured logging (JSON format), minden query audit trail (timestamp, user_id, query, response, cost, PII detection flag), GDPR/AI Act compliance.
- [ ] **Cost alerting**: Email alert napi/havi k√∂lts√©g k√ºsz√∂b t√∫ll√©p√©s√©n√©l
  - Implement√°ci√≥: Napi/heti cron job Prometheus metrik√°k alapj√°n (daily_cost, monthly_cost √∂sszes√≠t√©s), email k√ºld√©s SendGrid API-val k√ºsz√∂b t√∫ll√©p√©skor (pl. napi $5, havi $100).
- [ ] **OpenTelemetry tracing**: Distributed tracing integration
  - Implement√°ci√≥: OpenTelemetry SDK integr√°ci√≥ (auto-instrumentation), span creation node-onk√©nt (intent, retrieval, generation), Jaeger/Zipkin backend trace visualization.

#### UX Enhancements
- [ ] **WebSocket support**: Real-time streaming responses
  - Implement√°ci√≥: Django Channels WebSocket consumer, bidirectional kommunik√°ci√≥ (query submit + real-time streaming response), connection management (reconnect logic).
- [ ] **Multi-language support**: Automatikus nyelvdetekci√≥ √©s ford√≠t√°s
  - Implement√°ci√≥: langdetect library query nyelv√©nek detekt√°l√°s√°ra, Google Translate API nem-angol query-k ford√≠t√°s√°ra angol-ra (RAG input), v√°lasz visszaford√≠t√°s eredeti nyelvre.
- [ ] **Streaming Response**: Token-by-token streaming (SSE/WebSocket), UX: -60% √©szlelt latency
  - Implement√°ci√≥: SSE endpoint (/stream), OpenAI streaming API (stream=True), frontend EventSource vagy WebSocket. Felhaszn√°l√≥ azonnali feedback-et kap, m√©g miel≈ëtt a teljes v√°lasz elk√©sz√ºlne.

#### Advanced Optimizations
- [ ] **Batch Query API**: P√°rhuzamos t√∂bb query feldolgoz√°s (asyncio.gather) + OpenAI Batch API (50% olcs√≥bb, 24h delay)
  - Implement√°ci√≥: /batch endpoint (t√∂bb query egy requestben), asyncio.gather parallel feldolgoz√°s, vagy OpenAI Batch API (50% olcs√≥bb, de 24h v√°laszid≈ë). Bulk import/report gener√°l√°shoz ide√°lis.
- [ ] **Model Fallback Strategy**: Auto-fallback GPT-4 ‚Üí GPT-4-turbo ‚Üí GPT-3.5 (rate limit/timeout eset√©n)
  - Implement√°ci√≥: Try-except wrapper LLM h√≠v√°sok k√∂r√ºl, automatic retry olcs√≥bb modellel (rate limit/timeout exception catch). +30% megb√≠zhat√≥s√°g, -10% √°tlagos k√∂lts√©g peak id≈ëszakokban.
- [ ] **Prompt Compression**: DELTA prompting (csak v√°ltoz√°sok k√ºld√©se, nem teljes context, 15-20% token cs√∂kken√©s)
  - Implement√°ci√≥: Conversation history diff-el√©se (csak √∫j/v√°ltozott r√©szek k√ºld√©se), context compression algorithms (gzip, custom summarization). 15-20% token megtakar√≠t√°s hossz√∫ besz√©lget√©sekn√©l.

#### üéØ Multi-Tool Agent - F√°zis 3-4 (H√°zi Feladat)

##### F√°zis 3: Error Handling & Resilience (1-2 h√©t)
- [ ] **Retry Node**: RetryNode implement√°ci√≥ (max_retries, exponential backoff), error classification (transient vs permanent)
- [ ] **Fallback Model Logic**: gpt-4o-mini ‚Üí gpt-3.5-turbo fallback, cost optimization, state tracking
- [ ] **Guardian Node**: AI Act compliance, PII detection, content policy check, audit logging
- [ ] **Fail-Safe Response**: FailSafeResponse Pydantic model, ultimate fallback (HU+EN), graceful degradation
  - Deliverable: docs/h√°zi feladatok/IMPLEMENTATION_PHASE_3.md, test_retry_node.py, test_guardian.py

##### F√°zis 4: Memory & Context Handling (1-2 h√©t)
- [ ] **Long-Term Memory**: UserProfile DB schema (Postgres), UserMemoryStore CRUD, profile loading in intent_detection
- [ ] **Multi-Level Summarization**: Short (8 msg), Medium (50 msg), Long (200+ msg) tiers, automatic tier selection
- [ ] **Retrieval-Before-Tools**: RAG context augmentation in tool prompts, tool observation ‚Üí memory feedback
  - Deliverable: docs/h√°zi feladatok/IMPLEMENTATION_PHASE_4.md, test_user_memory.py, DB migration

---

## üìö Referenci√°k & Dokument√°ci√≥

**Saj√°t dokument√°ci√≥:**
- ‚úÖ docs/archive/AGENT_ARCHITECTURE_ANALYSIS.md
- üìù docs/archive/IMPLEMENTATION_PHASE_*.md (tervezett)
- ‚úÖ docs/MONITORING.md

**K√ºls≈ë forr√°sok:**
- [AI Agent 4 R√©teg Architekt√∫ra](https://github.com/adrgul/ai_agent_tutorial/blob/main/docs/AI_AGENT_4_RETEG_ARCHITEKTURA.md)
- [K√∂lts√©goptimaliz√°l√°s](https://github.com/adrgul/ai_agent_tutorial/blob/good-version/10_cost_optimization/docs/JAVITASOK_RESZLETESEN.md)
- [Monitoring & Prometheus](https://github.com/adrgul/ai_agent_tutorial/blob/main/docs/09_MONITORING_PROMPT.md)
- [Infra/Cloud] https://github.com/adrgul/ai-agent-infra, abb√≥l is https://github.com/adrgul/ai-agent-infra/blob/main/docs/DEVOPS_TUTORIAL_HU.md 
- [LangGraph-√°llapotkezel√©s] https://github.com/adrgul/ai-agent-infra/blob/main/docs/ALLAPOTKEZELES_RESZLETEK.md
---

## ‚öôÔ∏è Implement√°ci√≥s Jegyzetek

**M√≥dos√≠tand√≥ f√°jlok (priorit√°s szerint):**
- `services/agent.py` - √∫j nodes (Plan, Tool Selection, Observation)
- `domain/llm_outputs.py` - ExecutionPlan, ToolSelection, ObservationOutput
- `infrastructure/tool_registry.py` - (Tool Registry Pattern)
- `infrastructure/user_memory.py` - NEW (F√°zis 4)
- `tests/test_plan_node.py`, `test_tool_executor.py`

**Quick Wins (MVP-k 4-5 h√©t alatt):**
1. Plan Node alapok (2-3 nap)
2. Tool Selection Node (3-4 nap)
3. Tool Executor Loop (1 h√©t)
4. Observation Node (3 nap)

