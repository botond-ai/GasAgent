# üÜì Ingyenes Render Deployment - KnowledgeRouter CI/CD

## üìã Tartalomjegyz√©k

1. [Platform √ñsszehasonl√≠t√°s](#platform-√∂sszehasonl√≠t√°s)
2. [Render.com Deployment](#rendercom-deployment)
3. [Gyors Start Guide](#gyors-start-guide)
4. [Troubleshooting](#troubleshooting)

---

## Platform √ñsszehasonl√≠t√°s

| Platform | Free Tier | El≈ëny√∂k | H√°tr√°nyok | Aj√°nlott? |
|----------|-----------|---------|-----------|-----------|
| **Render.com** | Unlimited (sleep after 15min) | PostgreSQL ingyen, Auto-deploy, Blueprint support | Cold start (30-60s), PostgreSQL 90 nap lej√°rat | ‚úÖ **IGEN** |
| **Fly.io** | 3 VM ingyen | PostgreSQL, Redis ingyen, Gyors deployment | Komplex CLI, Nincs web UI | ‚ùå T√∫l bonyolult |
| **Heroku** | ‚ùå Nincs free tier | N/A | 2022 √≥ta fizet≈ës | ‚ùå NEM |

### üèÜ Aj√°nl√°s: **Render.com**

**Mi√©rt?**
- ‚úÖ Teljesen ingyenes (korl√°tlan ideig)
- ‚úÖ PostgreSQL managed database (90 nap, √∫jraind√≠that√≥)
- ‚úÖ Web UI (egyszer≈± setup)
- ‚úÖ GitHub auto-deploy (push ‚Üí deploy)
- ‚úÖ Blueprint support (render.yaml)

**Trade-off:**
- ‚ùå Sleep after 15 min inactivity (cold start: 30-60s)
- ‚ùå PostgreSQL 90 nap ut√°n expire (√∫jra kell ind√≠tani)

---

## Render.com Deployment

### 1Ô∏è‚É£ El≈ëk√©sz√ºletek

#### A) Render.com Account

1. Navig√°lj: [https://render.com/](https://render.com/)
2. **Sign up with GitHub** (GitHub OAuth)
3. Authorize Render app

#### B) Repository Setup

F√°jlok megl√©t√©nek ellen≈ërz√©se:
- ‚úÖ `render.yaml` (Blueprint config)
- ‚úÖ `Dockerfile.redis` (Redis service)
- ‚úÖ `Dockerfile.qdrant` (Qdrant vector DB)
- ‚úÖ `backend/Dockerfile` (Django backend)
- ‚úÖ `.github/workflows/deploy-render.yml` (CI/CD)

---

### 2Ô∏è‚É£ Blueprint Deployment

#### L√©p√©sek a Render Dashboard-on:

1. **New ‚Üí Blueprint**
2. **Connect GitHub repository:**
   - Repository: `benke.tibor` (vagy a saj√°t fork)
   - Branch: `main`
3. **Blueprint File:** `render.yaml` (auto-detect)
4. **Review Services:**
   ```
   ‚úì knowledgerouter-backend (Web Service)
   ‚úì knowledgerouter-frontend (Static Site)
   ‚úì knowledgerouter-db (PostgreSQL)
   ‚úì knowledgerouter-redis (Private Service)
   ‚úì knowledgerouter-qdrant (Private Service)
   ```
5. **Environment Variables Setup:**

   **Backend service-n√©l be√°ll√≠t√°s:**
   ```bash
   # CRITICAL: OpenAI API Key
   OPENAI_API_KEY=sk-proj-YOUR_KEY_HERE
   
   # Optional: External APIs
   CONFLUENCE_BASE_URL=https://your-domain.atlassian.net
   CONFLUENCE_API_TOKEN=ATATT3xFfG...
   CONFLUENCE_EMAIL=user@example.com
   
   JIRA_BASE_URL=https://your-domain.atlassian.net
   JIRA_API_TOKEN=ATATT3xFfG...
   JIRA_EMAIL=user@example.com
   
   # Auto-generated (Render be√°ll√≠tja):
   # - SECRET_KEY (auto)
   # - POSTGRES_HOST/PORT/DB/USER/PASSWORD (auto-linked)
   # - REDIS_HOST/PORT (auto-linked)
   # - QDRANT_HOST/PORT (auto-linked)
   ```

6. **Deploy!** (5-10 perc)

---

### 3Ô∏è‚É£ GitHub Actions CI/CD Setup

#### A) GitHub Secrets be√°ll√≠t√°sa

Repository ‚Üí **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions** ‚Üí **New repository secret**

Sz√ºks√©ges secrets:

| Secret Name | √ârt√©k | Honnan szerezd? |
|-------------|-------|-----------------|
| `RENDER_DEPLOY_HOOK` | `https://api.render.com/deploy/srv-xxxxx?key=xxxxx` | Render Dashboard ‚Üí Service ‚Üí Settings ‚Üí Deploy Hook |
| `RENDER_BACKEND_URL` | `https://knowledgerouter-backend.onrender.com` | Render Dashboard ‚Üí Service URL |
| `SLACK_WEBHOOK_URL` (optional) | `https://hooks.slack.com/services/xxx` | Slack App ‚Üí Incoming Webhooks |

#### B) Deploy Hook megszerz√©se (RENDER_DEPLOY_HOOK)

1. Render Dashboard ‚Üí **knowledgerouter-backend** service
2. **Settings** tab
3. Scroll down ‚Üí **Deploy Hook**
4. **Copy** ‚Üí Paste GitHub Secrets-be

#### C) Tesztel√©s

```bash
# Push to main branch
git add .
git commit -m "feat: test Render deployment"
git push origin main
```

GitHub Actions workflow:
1. ‚úÖ Test & Lint
2. ‚úÖ Security Scan (Trivy)
3. ‚úÖ Trigger Render Deploy
4. ‚úÖ Health Check (`/api/healthz`)
5. ‚úÖ API Test (sample query)

---

### 4Ô∏è‚É£ Els≈ë Deployment Ellen≈ërz√©se

#### A) Render Logs

1. Dashboard ‚Üí **knowledgerouter-backend**
2. **Logs** tab
3. Ellen≈ërizd:
   ```
   ‚úì Build successful
   ‚úì Starting service...
   ‚úì Uvicorn running on http://0.0.0.0:10000
   ‚úì Health check passed
   ```

#### B) Manual Health Check

```bash
# Backend health
curl https://knowledgerouter-backend.onrender.com/api/healthz

# Expected response:
{
  "status": "healthy",
  "database": "connected",
  "redis": "connected",
  "qdrant": "connected"
}
```

#### C) Frontend El√©r√©se

Navig√°lj: `https://knowledgerouter-frontend.onrender.com`

---

### 5Ô∏è‚É£ Cold Start Kezel√©se

**Probl√©ma:** Sleep after 15 min ‚Üí els≈ë request: 30-60s

**Megold√°sok:**

#### A) UptimeRobot Ping (Keep-Alive)

1. [https://uptimerobot.com/](https://uptimerobot.com/) (ingyenes)
2. **Add New Monitor**
   - Type: HTTP(S)
   - URL: `https://knowledgerouter-backend.onrender.com/api/healthz`
   - Interval: 5 minutes (Render free tier: 15 min sleep threshold)
3. **Create Monitor**

Result: Backend mindig "√©bren" marad (4 ping/√≥ra)

#### B) Beadand√≥ Demo El≈ëtt: Pre-Warm

```bash
# 5 perccel demo el≈ëtt (cold start elker√ºl√©se)
curl https://knowledgerouter-backend.onrender.com/api/healthz

# V√°rj 30s (backend fel√©bredt)
# Most m√°r fast response!
```

---

## Gyors Start Guide

### üöÄ Leggyorsabb √öt: Render.com (5 perc)

```bash
# 1. Clone repository
git clone https://github.com/YOUR_USERNAME/ai-agents-hu.git
cd ai-agents-hu/mini_projects/benke.tibor

# 2. Render.com-on:
#    - New Blueprint
#    - Connect GitHub repo
#    - Upload render.yaml
#    - Set OPENAI_API_KEY

# 3. GitHub Secrets (optional CI/CD):
#    - RENDER_DEPLOY_HOOK
#    - RENDER_BACKEND_URL

# 4. Push to main
git add .
git commit -m "feat: deploy to Render"
git push origin main

# 5. V√°rj 5-10 percet
# 6. Nyisd meg: https://knowledgerouter-backend.onrender.com
```

---

## Troubleshooting

### ‚ùå Render: "Build failed"

**Hiba:**
```
Step 5/10 : RUN pip install -r requirements.txt
ERROR: Could not find a version that satisfies the requirement...
```

**Megold√°s:**
```bash
# backend/requirements.txt - ellen≈ërizd verzi√≥k kompatibilit√°s√°t
pip install --upgrade pip
pip freeze > requirements.txt  # Friss√≠tsd a lock f√°jlt
```

---

### ‚ùå Render: "Health check failed"

**Hiba:**
```
Health check timeout (30s)
```

**Megold√°s:**

1. Ellen≈ërizd a health check endpoint:
   ```python
   # backend/api/views.py
   @api_view(['GET'])
   def healthz(request):
       return Response({"status": "healthy"})
   ```

2. N√∂veld a timeout-ot (render.yaml):
   ```yaml
   healthCheckPath: /api/healthz
   # Nincs timeout config Render free tier-ben, fix 30s
   ```

3. Ellen≈ërizd a logokat:
   - Render Dashboard ‚Üí Service ‚Üí Logs
   - Keress: `ERROR`, `CRITICAL`

---

### ‚ùå Railway: "Out of credit"

**Hiba:**
```
Service stopped due to insufficient credits
```

**Megold√°s:**

1. Kapcsold ki a monitoring szolg√°ltat√°sokat:
   ```bash
   # Railway Dashboard ‚Üí prometheus service ‚Üí Delete
   # Railway Dashboard ‚Üí grafana service ‚Üí Delete
   ```

2. Ellen≈ërizd a kredit fogyaszt√°st:
   - Dashboard ‚Üí Usage
   - V√°rhat√≥: ~$0.15/nap (7 service = $4.50/h√≥)

3. Scale down (1 replica):
   ```yaml
   # docker-compose.yml
   services:
     backend:
       deploy:
         replicas: 1  # 2 helyett 1
   ```

---

### ‚ùå GitHub Actions: "Health check failed"

**Hiba:**
```
‚ùå Health check failed after 10 attempts (2.5 minutes)
```

**Megold√°s:**

1. **Cold start:** Render sleep ‚Üí v√°rj 60s helyett 90s
   ```yaml
   # .github/workflows/deploy-render.yml
   - name: Wait for deployment (60 seconds)
     run: sleep 90  # 60 helyett 90
   ```

2. **Wrong URL:** Ellen≈ërizd GitHub Secret
   ```bash
   # GitHub Secrets: RENDER_BACKEND_URL
   # Helyes: https://knowledgerouter-backend.onrender.com
   # Helytelen: http://knowledgerouter-backend.onrender.com (http!)
   ```

3. **CORS hiba:** Django settings
   ```python
   # core/settings.py
   ALLOWED_HOSTS = ['.onrender.com', 'localhost', '127.0.0.1']
   ```

---
| Tutorial Technika | Implement√°ci√≥ | F√°jl |
|-------------------|---------------|------|
| **GitHub Actions CI/CD** | Test ‚Üí Build ‚Üí Deploy ‚Üí Health Check | `.github/workflows/deploy-render.yml` |
| **Multi-service Orchestration** | 7 kont√©ner (backend, frontend, DB, cache, vector DB, monitoring) | `render.yaml`, `docker-compose.yml` |
| **Health Checks** | `/api/healthz` endpoint, retry logic | `deploy-render.yml` (lines 150-180) |
| **Environment Variables** | Secrets Manager (OPENAI_KEY), Database auto-link | `render.yaml` (envVars) |
| **Docker Multi-stage Build** | Layer caching, size optimization | `backend/Dockerfile` |
| **Security Scanning** | Trivy vulnerability scan | `deploy-render.yml` (job: security-scan) |
| **Auto-rollback** | Health check fail ‚Üí previous version | Render auto-rollback |
| **Monitoring** | Logs aggregation (CloudWatch ‚Üí Render Logs) | Render Dashboard |

---

## √ñsszefoglal√°s

### üéØ Beadand√≥hoz Aj√°nlott Setup

1. **Platform:** Render.com (100% ingyenes)
2. **Services:** Backend + Frontend + PostgreSQL + Redis + Qdrant (5 service)
3. **Monitoring:** Render be√©p√≠tett metrics (Prometheus/Grafana n√©lk√ºl)
4. **CI/CD:** GitHub Actions (auto-deploy main push-ra)
5. **Cold Start Fix:** UptimeRobot ping (5 perc interval)

1. Render.com Blueprint setup: 5 perc
2. Environment variables: 3 perc
3. GitHub Secrets: 2 perc
4. First deployment: 5-10 perc
5. Health check + test: 2 perc

### üí∞ K√∂lts√©g: $0/h√≥ (100% ingyenes)

### üìö Technik√°k

- ‚úÖ Infrastructure as Code (render.yaml Blueprint)
- ‚úÖ CI/CD automation (GitHub Actions)
- ‚úÖ Multi-service deployment (7 container orchestration)
- ‚úÖ Health monitoring (automated health checks)
- ‚úÖ Security scanning (Trivy vulnerability detection)
- ‚úÖ Environment management (secrets, configs)
- ‚úÖ Auto-scaling (Render auto-scale on load)


