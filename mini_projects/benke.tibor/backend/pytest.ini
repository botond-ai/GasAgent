[pytest]
# Pytest configuration for KnowledgeRouter backend tests

# Async test support
asyncio_mode = auto

# Test output
addopts = 
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    --color=yes
    --cov=infrastructure
    --cov-report=term-missing
    --cov-report=html
    --cov-fail-under=10

# Django settings
env = 
    DJANGO_SETTINGS_MODULE=core.settings

# Test paths
testpaths = tests

# Test discovery
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Markers
markers =
    unit: Unit tests (fast, no external dependencies)
    integration: Integration tests (may require external services)
    slow: Slow tests (take >1 second)
    
# Coverage
[coverage:run]
source = infrastructure
omit = 
    */tests/*
    */__pycache__/*
    */site-packages/*
    infrastructure/document_parser.py
    infrastructure/google_drive_client.py
    infrastructure/qdrant_rag_client.py
    infrastructure/rag_client.py
    infrastructure/repositories.py

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

[coverage:html]
directory = htmlcov
