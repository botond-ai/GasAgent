{"openapi":"3.1.0","info":{"title":"Knowledge Router - PROD 0.5.2","description":"Multi-tenant RAG Chat System with LangGraph, Document Management, and Long-Term Memory","version":"0.5.2"},"paths":{"/":{"get":{"tags":["Health & System"],"summary":"Root","description":"Root endpoint - basic health check.\n\nReturns:\n    {\"status\": \"ok\", \"message\": \"...\", \"version\": \"x.x.x\"}","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/health":{"get":{"tags":["Health & System"],"summary":"Health","description":"Health check endpoint for load balancers.\n\nReturns:\n    {\"status\": \"healthy\"}","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/version":{"get":{"tags":["Health & System"],"summary":"Get Version","description":"Get application version.\n\nReturns:\n    {\"version\": \"x.x.x\", \"name\": \"...\"}","operationId":"get_version_api_version_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/db-check":{"get":{"tags":["Health & System"],"summary":"Db Check","description":"Check PostgreSQL database connection.\n\nReturns:\n    {\"status\": \"connected\", \"database\": \"...\"} on success\n    {\"status\": \"error\", \"error\": \"...\"} on failure","operationId":"db_check_api_db_check_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/metrics":{"get":{"tags":["Monitoring","monitoring"],"summary":"Prometheus Metrics","description":"Prometheus metrics endpoint.\n\nReturns metrics in Prometheus exposition format for scraping.\n\nMetrics include:\n- LLM requests, tokens, cost, latency\n- Agent errors, node duration, iterations\n- RAG search duration, relevance scores, cache hits\n- Infrastructure errors, timeouts, retries\n\nScraped by Prometheus every 15s (configured in monitoring/prometheus/prometheus.yml).\n\nReturns:\n    Response with text/plain Prometheus metrics","operationId":"prometheus_metrics_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/test/test-logging":{"get":{"tags":["Testing"],"summary":"Test Logging","description":"Test structured JSON logging with correlation IDs.\n\nExpected log output:\n{\n    \"timestamp\": \"2026-01-17T...\",\n    \"level\": \"INFO\",\n    \"message\": \"Test log message\",\n    \"request_id\": \"...\",\n    \"tenant_id\": 1,\n    \"user_id\": 1\n}","operationId":"test_logging_api_test_test_logging_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/tenants":{"get":{"tags":["Tenants"],"summary":"List Tenants","description":"Get all tenants or only active ones.\n\nArgs:\n    active_only: Filter to only active tenants (default: True)\n\nReturns:\n    List of tenant objects with id, name, is_active fields\n\nCache: 5 minutes TTL","operationId":"list_tenants_api_tenants_get","parameters":[{"name":"active_only","in":"query","required":false,"schema":{"type":"boolean","description":"Filter by active status","default":true,"title":"Active Only"},"description":"Filter by active status"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/tenants/{tenant_id}":{"get":{"tags":["Tenants"],"summary":"Get Tenant","description":"Get tenant details by ID.\n\nArgs:\n    tenant_id: Tenant identifier\n\nReturns:\n    Tenant object with full details\n\nRaises:\n    404: Tenant not found","operationId":"get_tenant_api_tenants__tenant_id__get","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"integer","title":"Tenant Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"tags":["Tenants"],"summary":"Update Tenant Endpoint","description":"Update tenant details.\n\nArgs:\n    tenant_id: Tenant identifier\n    update_data: Fields to update (name, is_active)\n\nReturns:\n    Updated tenant object\n\nSide effects:\n    - Invalidates tenant cache\n\nRaises:\n    404: Tenant not found","operationId":"update_tenant_endpoint_api_tenants__tenant_id__patch","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"integer","title":"Tenant Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantUpdateRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/tenants/{tenant_id}/users":{"get":{"tags":["Tenants"],"summary":"Get Tenant Users","description":"Get all users for a specific tenant (RESTful hierarchy).\n\nArgs:\n    tenant_id: Tenant identifier\n\nReturns:\n    List of user objects belonging to tenant\n\nCache: 5 minutes TTL\n\nRaises:\n    404: Tenant not found","operationId":"get_tenant_users_api_tenants__tenant_id__users_get","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"integer","title":"Tenant Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/users":{"get":{"tags":["Users"],"summary":"List Users","description":"Get all users, optionally filtered by tenant.\n\nArgs:\n    tenant_id: Filter users by tenant (optional)\n\nReturns:\n    List of user objects\n\nCache: 5 minutes TTL","operationId":"list_users_api_users_get","parameters":[{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Filter users by tenant","title":"Tenant Id"},"description":"Filter users by tenant"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/users/{user_id}":{"get":{"tags":["Users"],"summary":"Get User","description":"Get user details by ID.\n\nArgs:\n    user_id: User identifier\n\nReturns:\n    User object with full details\n\nRaises:\n    404: User not found","operationId":"get_user_api_users__user_id__get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"tags":["Users"],"summary":"Update User Endpoint","description":"Update user details.\n\nArgs:\n    user_id: User identifier\n    update_data: Fields to update (nickname, system_prompt, default_lang)\n\nReturns:\n    Updated user object\n\nSide effects:\n    - Invalidates user cache\n\nRaises:\n    404: User not found","operationId":"update_user_endpoint_api_users__user_id__patch","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdateRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/users/{user_id}/debug":{"get":{"tags":["Users"],"summary":"Get User Debug Info","description":"Get debug information for a user.\n\nREST: Debug info is a sub-resource of user.\n\nReturns:\n    {\"user_data\": {...}}\n\nRaises:\n    404: User not found\n\nUse case: Frontend debug panel, admin diagnostics","operationId":"get_user_debug_info_api_users__user_id__debug_get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}},{"name":"tenant_id","in":"query","required":true,"schema":{"type":"integer","description":"Tenant ID","title":"Tenant Id"},"description":"Tenant ID"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/users/{user_id}/conversations":{"delete":{"tags":["Users"],"summary":"Delete User Conversations","description":"Delete all conversation history for a user.\n\nREST: Conversations are a sub-resource of user.\n\nDeletes:\n    - All chat_sessions for the user\n    - All chat_messages in those sessions (cascade)\n\nReturns:\n    {\"message\": \"...\", \"sessions_deleted\": int, \"messages_deleted\": int}\n\nRaises:\n    404: User not found\n\nUse case: Reset chat history (dev), GDPR compliance","operationId":"delete_user_conversations_api_users__user_id__conversations_delete","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/users/{user_id}/memories":{"get":{"tags":["Users"],"summary":"Get User Memories","description":"Get all long-term memories for a user.\n\nREST: Memories are a sub-resource of user.\n\nReturns:\n    {\"memories\": [...], \"count\": int}\n\nRaises:\n    404: User not found\n\nUse case: View stored facts, LTM debugging, user profile page","operationId":"get_user_memories_api_users__user_id__memories_get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Maximum number of memories to return","default":50,"title":"Limit"},"description":"Maximum number of memories to return"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions":{"get":{"tags":["Sessions"],"summary":"List User Sessions","description":"Get all sessions for a user, ordered by most recent activity.\n\nReturns sessions with:\n    - id, title, created_at, last_message_at\n    - message_count, is_deleted, processed_for_ltm\n\nTitle fallback: \"Új beszélgetés\" if no title set\n\nUse case: ChatGPT-style sidebar with conversation list","operationId":"list_user_sessions_api_sessions_get","parameters":[{"name":"user_id","in":"query","required":true,"schema":{"type":"integer","description":"User ID","title":"User Id"},"description":"User ID"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}/messages":{"get":{"tags":["Sessions"],"summary":"Get Session Messages","description":"Get all messages for a specific session.\n\nReturns messages in chronological order with:\n    - message_id, role, content, created_at, metadata\n\nUse case:\n    - Load conversation history when user opens a session\n    - Frontend chat display","operationId":"get_session_messages_api_sessions__session_id__messages_get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}},{"name":"user_id","in":"query","required":true,"schema":{"type":"integer","description":"User ID for security check","title":"User Id"},"description":"User ID for security check"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["Sessions"],"summary":"Add System Message","description":"Add a system or assistant message to session history.\n\nUse case:\n    - Manually inject system messages\n    - Record assistant responses (if not done by workflow)\n\nNote: User messages are added by /chat workflow, not here.","operationId":"add_system_message_api_sessions__session_id__messages_post","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddSystemMessageRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}/title":{"patch":{"tags":["Sessions"],"summary":"Update Session Title Endpoint","description":"Update session title.\n\nUse case:\n    - User renames conversation\n    - Auto-title generation from first message","operationId":"update_session_title_endpoint_api_sessions__session_id__title_patch","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateTitleRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}":{"delete":{"tags":["Sessions"],"summary":"Delete Session","description":"Soft delete a session.\n\nSets is_deleted=True, doesn't actually delete data.\n\nReturns:\n    204 No Content (empty body) on success\n\nStatus Codes:\n    204: Session successfully deleted (no content returned)\n    404: Session not found\n\nUse case:\n    - User deletes conversation from sidebar\n    - Hide from session list but preserve for recovery","operationId":"delete_session_api_sessions__session_id__delete","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}/consolidate":{"post":{"tags":["Sessions"],"summary":"Consolidate Session Memory","description":"Consolidate session STM → LTM.\n\nExtracts key facts from conversation and stores as long-term memories.\n\nUse case:\n    - Manual memory extraction\n    - End of long conversation\n    - Triggered by frontend \"remember this\" button\n\nRequest body:\n    {\"user_context\": {\"tenant_id\": 1, \"user_id\": 1}}\n\nReturns:\n    {\"status\": \"...\", \"memories_created\": int}","operationId":"consolidate_session_memory_api_sessions__session_id__consolidate_post","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConsolidateSessionRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/documents":{"get":{"tags":["Documents"],"summary":"List Documents","description":"List all documents accessible to the user.\n\nIncludes:\n    - Private documents owned by the user\n    - Tenant-wide documents in the user's tenant\n\nReturns:\n    Document metadata without full content\n\nUse case: Document library, file picker","operationId":"list_documents_api_documents_get","parameters":[{"name":"user_id","in":"query","required":true,"schema":{"type":"integer","description":"User ID","title":"User Id"},"description":"User ID"},{"name":"tenant_id","in":"query","required":true,"schema":{"type":"integer","description":"Tenant ID","title":"Tenant Id"},"description":"Tenant ID"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DocumentListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/documents/{document_id}":{"get":{"tags":["Documents"],"summary":"Get Document","description":"Get full document by ID including content.\n\nPermission check: Verifies user has read access to document.\n- Owner: Full access\n- Private documents: Owner only\n- Tenant documents: All tenant users (read access)\n\nReturns:\n    Full document with content field\n\nRaises:\n    404: Document not found\n    403: Access denied\n\nUse case: Document viewer, full-text search preview","operationId":"get_document_api_documents__document_id__get","parameters":[{"name":"document_id","in":"path","required":true,"schema":{"type":"integer","title":"Document Id"}},{"name":"user_id","in":"query","required":true,"schema":{"type":"integer","description":"User ID requesting access","title":"User Id"},"description":"User ID requesting access"},{"name":"tenant_id","in":"query","required":true,"schema":{"type":"integer","description":"Tenant ID of the user","title":"Tenant Id"},"description":"Tenant ID of the user"},{"name":"required_permission","in":"query","required":false,"schema":{"enum":["read","write","delete"],"type":"string","default":"read","title":"Required Permission"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DocumentDetail"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["Documents"],"summary":"Remove Document","description":"Delete a document and all its chunks.\n\nPermission check: Manual verification (owner only).\n- Tenant documents: Owner only (even if visible to all)\n- Private documents: Owner only\n\nSide effects:\n    - Deletes document_chunks (cascade)\n    - Removes Qdrant vectors (should be handled by service)\n\nReturns:\n    204 No Content (empty body) on success\n\nRaises:\n    404: Document not found\n    403: Access denied (not owner)\n\nStatus Codes:\n    204: Document successfully deleted (no content returned)\n    403: Forbidden - not document owner\n    404: Document not found\n\nUse case: Document library cleanup, GDPR deletion","operationId":"remove_document_api_documents__document_id__delete","parameters":[{"name":"document_id","in":"path","required":true,"schema":{"type":"integer","title":"Document Id"}},{"name":"user_id","in":"query","required":true,"schema":{"type":"integer","description":"User ID","title":"User Id"},"description":"User ID"},{"name":"tenant_id","in":"query","required":true,"schema":{"type":"integer","description":"Tenant ID","title":"Tenant Id"},"description":"Tenant ID"}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/documents/upload-decision":{"post":{"tags":["Documents"],"summary":"Handle Upload Decision","description":"Handle user decision for duplicate/similar document uploads.\n\nCalled when user makes a decision in the document upload workflow\nafter duplicate or similar documents are detected.\n\nArgs:\n    session_id: Upload session identifier\n    decision: User choice (replace, keep_both, cancel)\n    document_id: ID of document to replace (required for 'replace' decision)\n\nReturns:\n    {\"status\": \"success\", \"message\": \"Decision processed\"}\n\nUse case: Document upload duplicate detection workflow","operationId":"handle_upload_decision_api_documents_upload_decision_post","parameters":[{"name":"session_id","in":"query","required":true,"schema":{"type":"string","description":"Session ID","title":"Session Id"},"description":"Session ID"},{"name":"decision","in":"query","required":true,"schema":{"type":"string","description":"User decision: replace, keep_both, cancel","title":"Decision"},"description":"User decision: replace, keep_both, cancel"},{"name":"document_id","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Document ID for replace decision","title":"Document Id"},"description":"Document ID for replace decision"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Handle Upload Decision Api Documents Upload Decision Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/chat":{"post":{"tags":["Chat"],"summary":"Chat Unified","description":"Unified chat endpoint with agent-based routing (LangGraph workflow).\n\nPipeline:\n1. Session management (create/validate session)\n2. Execute UnifiedChatWorkflow (agent decides: CHAT | RAG | LIST)\n3. Persist user message (AFTER workflow to prevent chat_history duplication)\n4. Persist assistant message (async background task for faster response)\n5. Return response with session context\n\nAgent routes:\n- CHAT: Personal conversation with user context + chat history\n- RAG: Document search (embedding -> Qdrant -> PostgreSQL -> LLM)\n- LIST: Document listing (metadata + titles)\n\nReturns:\n    UnifiedChatResponse with answer, source document IDs, session_id, and error (if any)\n\nRaises:\n    400: Invalid input\n    503: Workflow not available (OPENAI_API_KEY missing)\n    500: Workflow execution error\n\nUse case: Main chat interface (ChatGPT-style)","operationId":"chat_unified_api_chat_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UnifiedChatRequest"}}},"required":true},"responses":{"200":{"description":"Existing session - chat response generated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UnifiedChatResponse"}}}},"201":{"description":"New session created - chat response generated"},"400":{"description":"Bad Request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"503":{"description":"Service Unavailable","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"429":{"description":"Too many requests - rate limit exceeded"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflows/process-document":{"post":{"tags":["Workflows"],"summary":"Process Document Workflow","description":"**NEW: Automated Document Processing Workflow (ASYNC)**\n\nReturns 202 Accepted - workflow started, processing in background.\n\nReplaces 3 manual API calls with single automated pipeline:\n\nOLD WAY (manual):\n1. POST /api/documents/upload\n2. POST /api/documents/{id}/chunk\n3. POST /api/documents/{id}/embed\n\nNEW WAY (automated):\n1. POST /api/workflows/process-document ✨\n\nPipeline steps (automatic):\n- File validation\n- Content extraction (PDF/TXT/MD)\n- Database storage\n- Text chunking\n- Embedding generation\n- Qdrant upload\n- Verification\n\nBenefits:\n- Single API call\n- Automatic error recovery\n- State tracking\n- Consistent processing\n- Better error messages\n\nArgs:\n    file: Document file (PDF, TXT, or MD)\n    tenant_id: Tenant identifier\n    user_id: User identifier\n    visibility: Document visibility level\n\nReturns (HTTP 202 Accepted):\n    {\n        \"status\": \"processing\" | \"success\" | \"failed\",\n        \"task_id\": str (session_id for tracking),\n        \"document_id\": int (if completed),\n        \"summary\": {\n            \"filename\": str,\n            \"content_length\": int,\n            \"chunk_count\": int,\n            \"embedding_count\": int,\n            \"qdrant_vectors\": int\n        }\n    }\n\nRaises:\n    400: Invalid file or parameters\n    500: Processing error\n\nStatus Codes:\n    202: Workflow accepted and started (async processing)\n    400: Invalid request\n    500: Workflow execution error\n\nUse case: Document upload via frontend (single button replaces multi-step upload)","operationId":"process_document_workflow_api_workflows_process_document_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_process_document_workflow_api_workflows_process_document_post"}}},"required":true},"responses":{"202":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflows/status":{"get":{"tags":["Workflows"],"summary":"Workflow Status","description":"Get workflow system status.\n\nReturns information about available workflows and their configuration.\n\nUse case: Health check, monitoring dashboard","operationId":"workflow_status_api_workflows_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/workflow-executions/{execution_id}":{"get":{"tags":["Workflow Tracking"],"summary":"Get Workflow Execution","description":"Get complete workflow execution details.\n\nReturns:\n- Execution metadata (duration, status, tokens, cost)\n- Input query and final answer\n- Tool invocations summary\n- Error details if failed","operationId":"get_workflow_execution_api_workflow_executions__execution_id__get","parameters":[{"name":"execution_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Execution Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WorkflowExecutionResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions":{"get":{"tags":["Workflow Tracking"],"summary":"List Workflow Executions","description":"List workflow executions with filtering and pagination.\n\nSupports filtering by:\n- session_id: All executions in a chat session\n- tenant_id: All executions for a tenant\n- user_id: All executions for a user\n- status: Filter by execution status\n\nResults ordered by started_at DESC (most recent first).","operationId":"list_workflow_executions_api_workflow_executions_get","parameters":[{"name":"session_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"description":"Filter by chat session","title":"Session Id"},"description":"Filter by chat session"},{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Filter by tenant","title":"Tenant Id"},"description":"Filter by tenant"},{"name":"user_id","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Filter by user","title":"User Id"},"description":"Filter by user"},{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by status (running, success, error, timeout)","title":"Status"},"description":"Filter by status (running, success, error, timeout)"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Maximum results (1-100)","default":20,"title":"Limit"},"description":"Maximum results (1-100)"},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Results offset for pagination","default":0,"title":"Offset"},"description":"Results offset for pagination"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/WorkflowExecutionResponse"},"title":"Response List Workflow Executions Api Workflow Executions Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions/{execution_id}/nodes":{"get":{"tags":["Workflow Tracking"],"summary":"Get Node Executions","description":"Get all node executions for a workflow.\n\nReturns:\n- Node execution timeline (ordered by node_index)\n- Duration and status per node\n- State diffs (before/after snapshots)\n- Node-specific metadata (LLM tokens, tool results)","operationId":"get_node_executions_api_workflow_executions__execution_id__nodes_get","parameters":[{"name":"execution_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Execution Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/NodeExecutionResponse"},"title":"Response Get Node Executions Api Workflow Executions  Execution Id  Nodes Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions/{execution_id}/prompt-lineage":{"get":{"tags":["Workflow Tracking"],"summary":"Get Prompt Lineage","description":"Get agent decision chain and prompt lineage.\n\nReconstructs:\n- Agent reasoning steps (decision → reflection → finalize)\n- LLM prompt/response pairs with token counts\n- Tool invocation results and context\n- Decision confidence scores and alternatives considered","operationId":"get_prompt_lineage_api_workflow_executions__execution_id__prompt_lineage_get","parameters":[{"name":"execution_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Execution Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PromptLineageResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions/{execution_id}/state-timeline":{"get":{"tags":["Workflow Tracking"],"summary":"Get State Timeline","description":"Get state mutation timeline for debugging.\n\nReturns:\n- State snapshots before/after each node\n- Diff highlighting changed fields\n- Timeline visualization data","operationId":"get_state_timeline_api_workflow_executions__execution_id__state_timeline_get","parameters":[{"name":"execution_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Execution Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/StateTimelineResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions/{execution_id}/cost-breakdown":{"get":{"tags":["Workflow Tracking"],"summary":"Get Cost Breakdown","description":"Get detailed cost and token analysis.\n\nReturns:\n- Cost breakdown by model and operation\n- Token usage flow (input → processing → output)\n- Cost per node analysis\n- Efficiency metrics","operationId":"get_cost_breakdown_api_workflow_executions__execution_id__cost_breakdown_get","parameters":[{"name":"execution_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Execution Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CostBreakdownResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions/{execution_id}/trace-context":{"get":{"tags":["Workflow Tracking"],"summary":"Get Trace Context","description":"Get distributed tracing context and correlation.\n\nReturns:\n- request_id, trace_id, session_id correlation\n- OpenTelemetry span hierarchy\n- Cross-service dependencies","operationId":"get_trace_context_api_workflow_executions__execution_id__trace_context_get","parameters":[{"name":"execution_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Execution Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TraceContextResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions/{execution_id}/rag-relevance":{"get":{"tags":["Workflow Tracking"],"summary":"Get Rag Relevance","description":"Get RAG retrieval relevance analysis.\n\nReturns:\n- Retrieved chunks with relevance scores\n- Relevance distribution histogram\n- Empty result analysis","operationId":"get_rag_relevance_api_workflow_executions__execution_id__rag_relevance_get","parameters":[{"name":"execution_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Execution Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions/{execution_id}/state-snapshot":{"get":{"tags":["Workflow Tracking"],"summary":"Get State Snapshot","description":"Get state snapshot at specific node or final state.\n\nParameters:\n- node_index: Get state after specific node (0-based), or final if None","operationId":"get_state_snapshot_api_workflow_executions__execution_id__state_snapshot_get","parameters":[{"name":"execution_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Execution Id"}},{"name":"node_index","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Node Index"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions/{execution_id}/state-diff/{node_index}":{"get":{"tags":["Workflow Tracking"],"summary":"Get State Diff","description":"Get state diff for specific node execution.\n\nReturns before/after state comparison with highlighted changes.","operationId":"get_state_diff_api_workflow_executions__execution_id__state_diff__node_index__get","parameters":[{"name":"execution_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Execution Id"}},{"name":"node_index","in":"path","required":true,"schema":{"type":"integer","title":"Node Index"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/workflow-executions/analytics/summary":{"get":{"tags":["Workflow Tracking"],"summary":"Get Execution Summary","description":"Get workflow execution analytics summary.\n\nReturns:\n- Success rate and error breakdown\n- Average duration and latency percentiles\n- Cost analysis and trends\n- Most common error patterns","operationId":"get_execution_summary_api_workflow_executions_analytics_summary_get","parameters":[{"name":"hours","in":"query","required":false,"schema":{"type":"integer","maximum":168,"minimum":1,"description":"Time window in hours (1-168)","default":24,"title":"Hours"},"description":"Time window in hours (1-168)"},{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Filter by tenant","title":"Tenant Id"},"description":"Filter by tenant"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/cache/warmup":{"post":{"tags":["Performance"],"summary":"Warmup Caches","description":"Warm up all caches for a user (tenant, user, system prompt).\n\nCalled by frontend when user is selected from dropdown.\nPre-loads caches to eliminate cold start on first message.\n\nPerformance impact:\n- Cold cache: ~800-1200ms (includes LLM system prompt generation)\n- Warm cache: ~2-5ms (all memory hits)\n\nArgs:\n    request: Tenant ID and User ID to warm up\n\nReturns:\n    WarmupResponse with cache hit/miss details and timing","operationId":"warmup_caches_api_cache_warmup_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/WarmupRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WarmupResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/cache/stats":{"get":{"tags":["Admin"],"summary":"Get Cache Stats","description":"Get comprehensive cache statistics for all layers.\n\nReturns statistics for:\n- Memory cache (Tier 1)\n- PostgreSQL cache (Tier 2)\n- Current configuration flags\n\n**Frontend**: Auto-refreshes every 5 seconds\n\nUse case: Admin dashboard monitoring","operationId":"get_cache_stats_api_admin_cache_stats_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CacheStatsResponse"}}}}}}},"/api/admin/cache/clear":{"post":{"tags":["Admin"],"summary":"Clear All Caches","description":"Clear ALL cache layers (memory + DB).\n\n⚠️ WARNING: This is a destructive operation!\n- Memory cache: All entries cleared\n- DB cache: All user_prompt_cache entries deleted\n\n**Use case**: Development/debugging when cache becomes stale","operationId":"clear_all_caches_api_admin_cache_clear_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CacheClearResponse"}}}}}}},"/api/admin/cache/user/{user_id}":{"delete":{"tags":["Admin"],"summary":"Invalidate User Cache","description":"Invalidate all caches for a specific user.\n\nClears:\n- Memory cache: system_prompt:{user_id}, user:{user_id}\n- DB cache: All user_prompt_cache entries for user\n\n**Use case**: User updates their system_prompt or preferences","operationId":"invalidate_user_cache_api_admin_cache_user__user_id__delete","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CacheInvalidateResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/cache/tenant/{tenant_id}":{"delete":{"tags":["Admin"],"summary":"Invalidate Tenant Cache","description":"Invalidate all caches for a tenant and its users.\n\nClears:\n- Memory cache: All tenant and user entries\n- DB cache: All user_prompt_cache entries for tenant's users\n\n**Use case**: Tenant updates company-wide system_prompt","operationId":"invalidate_tenant_cache_api_admin_cache_tenant__tenant_id__delete","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"integer","title":"Tenant Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CacheInvalidateResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/cache/enable":{"post":{"tags":["Admin"],"summary":"Enable Cache","description":"Enable caching at runtime (without restart).\n\n⚠️ Note: This only affects the in-memory cache flag.\nDEV_MODE in system.ini takes precedence.\n\n**Use case**: Re-enable cache after debugging","operationId":"enable_cache_api_admin_cache_enable_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/admin/cache/disable":{"post":{"tags":["Admin"],"summary":"Disable Cache","description":"Disable caching at runtime (without restart).\n\n⚠️ WARNING: This will impact performance!\nAll requests will hit the database directly.\n\n**Use case**: Debugging cache-related issues","operationId":"disable_cache_api_admin_cache_disable_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/admin/config/dev-mode":{"get":{"tags":["Admin"],"summary":"Get Dev Mode","description":"Get development mode status from system.ini.\n\nUsed by frontend to determine runtime cache behavior.\nReturns the current DEV_MODE setting which controls all cache layers.\n\n**Frontend**: Fetches once on app startup and caches the result.\n\nUse case: Frontend cache behavior detection","operationId":"get_dev_mode_api_admin_config_dev_mode_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DevModeResponse"}}}}}}},"/api/admin/config/idle-timeout":{"get":{"tags":["Admin"],"summary":"Get Idle Timeout","description":"Get idle timeout for auto-consolidation from system.ini.\n\nReturns the configured timeout in seconds.\nFrontend uses this to determine when to trigger session consolidation.\n\n**Frontend**: Fetches once on app startup.","operationId":"get_idle_timeout_api_admin_config_idle_timeout_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/admin/tracking-config/system":{"get":{"tags":["Admin Config","Admin"],"summary":"Get System Tracking Config","description":"Get system default tracking configuration.\n\nThis is the fallback config for all tenants without specific override.","operationId":"get_system_tracking_config_api_admin_tracking_config_system_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TrackingConfigResponse"}}}}}}},"/api/admin/tracking-config/{tenant_id}":{"get":{"tags":["Admin Config","Admin"],"summary":"Get Tenant Tracking Config","description":"Get effective tracking configuration for tenant.\n\nReturns tenant-specific config if exists, otherwise system default.","operationId":"get_tenant_tracking_config_api_admin_tracking_config__tenant_id__get","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"integer","title":"Tenant Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TrackingConfigResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["Admin Config","Admin"],"summary":"Reset Tenant Tracking Config","description":"Reset tenant to system default (remove tenant-specific override).\n\nAfter reset, tenant will use system default configuration.","operationId":"reset_tenant_tracking_config_api_admin_tracking_config__tenant_id__delete","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"integer","title":"Tenant Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/tracking-config":{"post":{"tags":["Admin Config","Admin"],"summary":"Set Tenant Tracking Config","description":"Set tracking level for tenant (all users in tenant).\n\nExamples:\n- Enable debug mode for 1 hour:\n  ```json\n  {\n    \"tenant_id\": 1,\n    \"level\": \"FULL_STATE\",\n    \"duration_hours\": 1\n  }\n  ```\n\n- Permanent metadata tracking:\n  ```json\n  {\n    \"tenant_id\": 1,\n    \"level\": \"METADATA_ONLY\"\n  }\n  ```\n\n- Disable tracking:\n  ```json\n  {\n    \"tenant_id\": 1,\n    \"level\": \"OFF\"\n  }\n  ```\n\n- Track only agent nodes:\n  ```json\n  {\n    \"tenant_id\": 1,\n    \"level\": \"METADATA_ONLY\",\n    \"tracked_nodes\": [\"agent_decide\", \"agent_reflection\"]\n  }\n  ```","operationId":"set_tenant_tracking_config_api_admin_tracking_config_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TrackingConfigRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/tracking-config/storage-impact":{"get":{"tags":["Admin Config","Admin"],"summary":"Get Storage Impact Estimation","description":"Calculate storage impact estimation for different tracking levels.\n\nQuery params:\n- workflows_per_day: Expected daily workflow count (default: 1000)\n- nodes_per_workflow: Average nodes per workflow (default: 12)\n\nReturns storage impact for OFF, METADATA_ONLY, FULL_STATE levels.","operationId":"get_storage_impact_estimation_api_admin_tracking_config_storage_impact_get","parameters":[{"name":"workflows_per_day","in":"query","required":false,"schema":{"type":"integer","maximum":100000,"minimum":1,"description":"Expected workflows per day","default":1000,"title":"Workflows Per Day"},"description":"Expected workflows per day"},{"name":"nodes_per_workflow","in":"query","required":false,"schema":{"type":"integer","maximum":50,"minimum":1,"description":"Average nodes per workflow","default":12,"title":"Nodes Per Workflow"},"description":"Average nodes per workflow"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/StorageImpactResponse"},"title":"Response Get Storage Impact Estimation Api Admin Tracking Config Storage Impact Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/debug/reset/postgres":{"post":{"tags":["Debug"],"summary":"Reset Postgres","description":"Reset PostgreSQL database - delete all documents and chunks.\n\n⚠️ WARNING: Destructive operation!\n- Deletes all document_chunks\n- Deletes all documents\n- Resets ID sequences\n\nUse case: Clean slate for testing","operationId":"reset_postgres_api_debug_reset_postgres_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/debug/reset/qdrant":{"post":{"tags":["Debug"],"summary":"Reset Qdrant","description":"Reset Qdrant - delete all points from document_chunks collection.\n\n⚠️ WARNING: Destructive operation!\n- Deletes all vectors for tenants 1-20\n\nUse case: Clean slate for testing","operationId":"reset_qdrant_api_debug_reset_qdrant_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/debug/reset/cache":{"post":{"tags":["Debug"],"summary":"Reset Cache","description":"Clear all cache layers.\n\n⚠️ WARNING: Affects all tenants/users!\n- Memory cache: All entries cleared\n- Context cache: Cleared\n\nUse case: Cache invalidation during testing","operationId":"reset_cache_api_debug_reset_cache_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AddSystemMessageRequest":{"properties":{"tenant_id":{"type":"integer","title":"Tenant Id"},"user_id":{"type":"integer","title":"User Id"},"role":{"type":"string","title":"Role"},"content":{"type":"string","title":"Content"},"metadata":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metadata"}},"type":"object","required":["tenant_id","user_id","role","content"],"title":"AddSystemMessageRequest","description":"Request body for adding system/assistant messages to chat history."},"Body_process_document_workflow_api_workflows_process_document_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"},"tenant_id":{"type":"integer","title":"Tenant Id"},"user_id":{"type":"integer","title":"User Id"},"visibility":{"type":"string","enum":["private","tenant"],"title":"Visibility"},"session_id":{"type":"string","title":"Session Id"},"enable_streaming":{"type":"boolean","title":"Enable Streaming","default":false}},"type":"object","required":["file","tenant_id","user_id","visibility"],"title":"Body_process_document_workflow_api_workflows_process_document_post"},"CacheClearResponse":{"properties":{"memory_cleared":{"type":"boolean","title":"Memory Cleared","description":"Whether memory cache was cleared"},"db_cleared":{"type":"integer","title":"Db Cleared","description":"Number of DB cache entries cleared"},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error","description":"Error message if operation failed"}},"type":"object","required":["memory_cleared","db_cleared"],"title":"CacheClearResponse","description":"Response from clear all caches operation."},"CacheConfig":{"properties":{"memory_enabled":{"type":"boolean","title":"Memory Enabled","description":"ENABLE_MEMORY_CACHE"},"db_enabled":{"type":"boolean","title":"Db Enabled","description":"ENABLE_DB_CACHE"},"browser_enabled":{"type":"boolean","title":"Browser Enabled","description":"ENABLE_BROWSER_CACHE"},"llm_enabled":{"type":"boolean","title":"Llm Enabled","description":"ENABLE_LLM_CACHE"}},"type":"object","required":["memory_enabled","db_enabled","browser_enabled","llm_enabled"],"title":"CacheConfig","description":"Cache configuration flags from system.ini."},"CacheInvalidateResponse":{"properties":{"user_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"User Id","description":"User ID that was invalidated"},"tenant_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Tenant Id","description":"Tenant ID that was invalidated"},"memory_cleared":{"type":"integer","title":"Memory Cleared","description":"Number of memory cache entries cleared","default":0},"db_cleared":{"type":"integer","title":"Db Cleared","description":"Number of DB cache entries cleared","default":0},"users_affected":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Users Affected","description":"Number of users affected (tenant invalidation)"},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error","description":"Error message if operation failed"}},"type":"object","title":"CacheInvalidateResponse","description":"Response from cache invalidation operations."},"CacheStatsResponse":{"properties":{"memory_cache":{"$ref":"#/components/schemas/MemoryCacheStats","description":"In-memory cache stats"},"db_cache":{"$ref":"#/components/schemas/DBCacheStats","description":"PostgreSQL cache stats"},"config":{"$ref":"#/components/schemas/CacheConfig","description":"Current cache configuration"},"timestamp":{"type":"string","title":"Timestamp","description":"ISO timestamp of stats collection"}},"type":"object","required":["memory_cache","db_cache","config","timestamp"],"title":"CacheStatsResponse","description":"Comprehensive cache statistics for all layers."},"ConsolidateSessionRequest":{"properties":{"user_context":{"$ref":"#/components/schemas/UserContextRequest","description":"User authentication context"}},"type":"object","required":["user_context"],"title":"ConsolidateSessionRequest","description":"Request for session memory consolidation (STM → LTM)."},"CostBreakdownResponse":{"properties":{"execution_id":{"type":"string","format":"uuid","title":"Execution Id"},"total_cost_usd":{"type":"number","title":"Total Cost Usd"},"cost_by_model":{"additionalProperties":{"additionalProperties":true,"type":"object"},"type":"object","title":"Cost By Model"},"cost_by_node":{"additionalProperties":{"type":"number"},"type":"object","title":"Cost By Node"},"token_flow":{"additionalProperties":{"type":"integer"},"type":"object","title":"Token Flow"},"efficiency_metrics":{"additionalProperties":{"type":"number"},"type":"object","title":"Efficiency Metrics"}},"type":"object","required":["execution_id","total_cost_usd"],"title":"CostBreakdownResponse","description":"Cost and token analysis."},"DBCacheStats":{"properties":{"enabled":{"type":"boolean","title":"Enabled","description":"Whether DB cache is enabled"},"cached_users":{"type":"integer","title":"Cached Users","description":"Number of users with cached prompts"},"total_entries":{"type":"integer","title":"Total Entries","description":"Total number of cache entries"},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error","description":"Error message if stats unavailable"}},"type":"object","required":["enabled","cached_users","total_entries"],"title":"DBCacheStats","description":"PostgreSQL cache statistics (Tier 2)."},"DevModeResponse":{"properties":{"dev_mode":{"type":"boolean","title":"Dev Mode","description":"Whether development mode is enabled (disables all caches)"}},"type":"object","required":["dev_mode"],"title":"DevModeResponse","description":"Development mode configuration from system.ini."},"DocumentDetail":{"properties":{"id":{"type":"integer","title":"Id"},"tenant_id":{"type":"integer","title":"Tenant Id"},"user_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"User Id"},"visibility":{"type":"string","title":"Visibility"},"source":{"type":"string","title":"Source"},"title":{"type":"string","title":"Title"},"content":{"type":"string","title":"Content"},"created_at":{"type":"string","format":"date-time","title":"Created At"}},"type":"object","required":["id","tenant_id","visibility","source","title","content","created_at"],"title":"DocumentDetail","description":"Full document with content."},"DocumentListResponse":{"properties":{"documents":{"items":{"$ref":"#/components/schemas/DocumentSummary"},"type":"array","title":"Documents"},"count":{"type":"integer","title":"Count"}},"type":"object","required":["documents","count"],"title":"DocumentListResponse","description":"Response for document list."},"DocumentSource":{"properties":{"id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Id","description":"Document ID (if type=document)"},"title":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Title","description":"Document title (if type=document)"},"type":{"type":"string","title":"Type","description":"Source type: 'document' or 'long_term_memory'","default":"document"},"content":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Content","description":"Memory content (if type=long_term_memory)"},"ltm_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Ltm Id","description":"Long-term memory ID (if type=long_term_memory)"}},"type":"object","title":"DocumentSource","description":"Source reference (document or long-term memory)."},"DocumentSummary":{"properties":{"id":{"type":"integer","title":"Id"},"tenant_id":{"type":"integer","title":"Tenant Id"},"user_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"User Id"},"visibility":{"type":"string","title":"Visibility"},"source":{"type":"string","title":"Source"},"title":{"type":"string","title":"Title"},"created_at":{"type":"string","format":"date-time","title":"Created At"}},"type":"object","required":["id","tenant_id","visibility","source","title","created_at"],"title":"DocumentSummary","description":"Summary of a document (without full content)."},"ErrorResponse":{"properties":{"detail":{"type":"string","title":"Detail","description":"Error message"}},"type":"object","required":["detail"],"title":"ErrorResponse"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MemoryCacheStats":{"properties":{"enabled":{"type":"boolean","title":"Enabled","description":"Whether memory cache is enabled"},"size":{"type":"integer","title":"Size","description":"Number of cached entries"},"keys":{"items":{"type":"string"},"type":"array","title":"Keys","description":"List of cache keys"},"ttl_seconds":{"type":"integer","title":"Ttl Seconds","description":"Time-to-live in seconds"},"debug_mode":{"type":"boolean","title":"Debug Mode","description":"Whether cache debug mode is enabled","default":false}},"type":"object","required":["enabled","size","keys","ttl_seconds"],"title":"MemoryCacheStats","description":"In-memory cache statistics (Tier 1)."},"NodeExecutionResponse":{"properties":{"node_execution_id":{"type":"integer","title":"Node Execution Id"},"execution_id":{"type":"string","format":"uuid","title":"Execution Id"},"node_name":{"type":"string","title":"Node Name"},"node_index":{"type":"integer","title":"Node Index"},"started_at":{"type":"string","format":"date-time","title":"Started At"},"completed_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Completed At"},"duration_ms":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Duration Ms"},"status":{"type":"string","title":"Status"},"error_message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error Message"},"state_before":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"State Before"},"state_after":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"State After"},"state_diff":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"State Diff"},"metadata":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metadata"},"parent_node":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Parent Node"}},"type":"object","required":["node_execution_id","execution_id","node_name","node_index","started_at","status"],"title":"NodeExecutionResponse","description":"Single node execution details."},"PromptLineageResponse":{"properties":{"execution_id":{"type":"string","format":"uuid","title":"Execution Id"},"trace_id":{"type":"string","title":"Trace Id"},"prompt_chain":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Prompt Chain"},"decision_points":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Decision Points"}},"type":"object","required":["execution_id","trace_id"],"title":"PromptLineageResponse","description":"Agent decision chain and prompt lineage."},"RAGParams":{"properties":{"top_k":{"type":"integer","title":"Top K","description":"Number of top results retrieved"},"min_score_threshold":{"type":"number","title":"Min Score Threshold","description":"Minimum similarity score threshold"}},"type":"object","required":["top_k","min_score_threshold"],"title":"RAGParams","description":"RAG search parameters used for retrieval."},"SearchMode":{"type":"string","enum":["vector","keyword","hybrid"],"title":"SearchMode","description":"Search mode for RAG retrieval."},"StateTimelineResponse":{"properties":{"execution_id":{"type":"string","format":"uuid","title":"Execution Id"},"timeline":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Timeline"}},"type":"object","required":["execution_id"],"title":"StateTimelineResponse","description":"State mutation timeline."},"StorageImpactResponse":{"properties":{"level":{"type":"string","title":"Level"},"per_node_kb":{"type":"number","title":"Per Node Kb"},"per_workflow_kb":{"type":"number","title":"Per Workflow Kb"},"per_day_mb":{"type":"number","title":"Per Day Mb"},"per_month_gb":{"type":"number","title":"Per Month Gb"}},"type":"object","required":["level","per_node_kb","per_workflow_kb","per_day_mb","per_month_gb"],"title":"StorageImpactResponse","description":"Storage impact estimation."},"TenantUpdateRequest":{"properties":{"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"system_prompt":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"System Prompt"},"is_active":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Is Active"},"settings":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Settings"}},"type":"object","title":"TenantUpdateRequest","description":"Request for updating tenant data."},"TraceContextResponse":{"properties":{"execution_id":{"type":"string","format":"uuid","title":"Execution Id"},"request_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Request Id","default":""},"trace_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Trace Id","default":""},"session_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Session Id","default":""},"tenant_id":{"type":"integer","title":"Tenant Id"},"user_id":{"type":"integer","title":"User Id"},"jaeger_trace_url":{"type":"string","title":"Jaeger Trace Url"},"tempo_trace_url":{"type":"string","title":"Tempo Trace Url"}},"type":"object","required":["execution_id","tenant_id","user_id","jaeger_trace_url","tempo_trace_url"],"title":"TraceContextResponse","description":"Distributed tracing context."},"TrackingConfigRequest":{"properties":{"tenant_id":{"type":"integer","title":"Tenant Id","description":"Tenant identifier"},"level":{"type":"string","enum":["OFF","METADATA_ONLY","FULL_STATE"],"title":"Level","description":"Tracking level"},"duration_hours":{"anyOf":[{"type":"integer","maximum":24.0,"minimum":1.0},{"type":"null"}],"title":"Duration Hours","description":"Temporary override duration (1-24 hours). If None, permanent."},"tracked_nodes":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Tracked Nodes","description":"Filter specific nodes (e.g. ['agent_decide', 'search']). If None, all nodes."}},"type":"object","required":["tenant_id","level"],"title":"TrackingConfigRequest","description":"Request model for setting tracking configuration."},"TrackingConfigResponse":{"properties":{"enabled":{"type":"boolean","title":"Enabled"},"level":{"type":"string","title":"Level"},"tracked_nodes":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Tracked Nodes"},"is_override":{"type":"boolean","title":"Is Override"},"override_expires_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Override Expires At"}},"type":"object","required":["enabled","level","tracked_nodes","is_override","override_expires_at"],"title":"TrackingConfigResponse","description":"Response model for tracking configuration."},"UnifiedChatRequest":{"properties":{"query":{"type":"string","minLength":1,"title":"Query","description":"User's question"},"user_context":{"$ref":"#/components/schemas/UserContextRequest","description":"User authentication context"},"session_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Session Id","description":"Session ID (auto-generated if not provided)"},"search_mode":{"$ref":"#/components/schemas/SearchMode","description":"Search mode: vector, keyword, or hybrid (default: hybrid)","default":"hybrid"},"vector_weight":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Vector Weight","description":"Vector search weight for hybrid mode (default: 0.7)","default":0.7},"keyword_weight":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Keyword Weight","description":"Keyword search weight for hybrid mode (default: 0.3)","default":0.3},"enable_query_rewrite":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Enable Query Rewrite","description":"Override query rewrite feature flag for A/B testing (None=use config default)"}},"type":"object","required":["query","user_context"],"title":"UnifiedChatRequest","description":"Request for unified chat endpoint (agent-based routing: CHAT | RAG | LIST | LTM)."},"UnifiedChatResponse":{"properties":{"answer":{"type":"string","title":"Answer","description":"Generated answer from workflow"},"sources":{"items":{"$ref":"#/components/schemas/DocumentSource"},"type":"array","title":"Sources","description":"List of source documents with titles"},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error","description":"Error message if any"},"session_id":{"type":"string","title":"Session Id","description":"Session ID for the conversation"},"execution_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Execution Id","description":"Workflow execution ID for debugging"},"prompt_details":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Prompt Details","description":"Debug info: prompt structure sent to LLM"},"rag_params":{"anyOf":[{"$ref":"#/components/schemas/RAGParams"},{"type":"null"}],"description":"RAG parameters used (only when RAG was triggered)"}},"type":"object","required":["answer","sources","session_id"],"title":"UnifiedChatResponse","description":"Response from unified chat endpoint (supports CHAT | RAG | LIST | LTM modes)."},"UpdateTitleRequest":{"properties":{"title":{"type":"string","title":"Title"}},"type":"object","required":["title"],"title":"UpdateTitleRequest"},"UserContextRequest":{"properties":{"tenant_id":{"type":"integer","title":"Tenant Id","description":"ID of the tenant"},"user_id":{"type":"integer","title":"User Id","description":"ID of the user sending the message"}},"type":"object","required":["tenant_id","user_id"],"title":"UserContextRequest","description":"User context for chat requests (groups authentication/authorization fields)."},"UserUpdateRequest":{"properties":{"firstname":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Firstname"},"lastname":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Lastname"},"nickname":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Nickname"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email"},"role":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Role"},"default_lang":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Default Lang"},"system_prompt":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"System Prompt"},"is_active":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Is Active"}},"type":"object","title":"UserUpdateRequest","description":"Request for updating user data."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"WarmupRequest":{"properties":{"tenant_id":{"type":"integer","title":"Tenant Id"},"user_id":{"type":"integer","title":"User Id"}},"type":"object","required":["tenant_id","user_id"],"title":"WarmupRequest","description":"Request to warm up caches for a user."},"WarmupResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"tenant_cached":{"type":"boolean","title":"Tenant Cached"},"user_cached":{"type":"boolean","title":"User Cached"},"system_prompt_cached":{"type":"boolean","title":"System Prompt Cached"},"cache_source":{"type":"string","title":"Cache Source"},"total_time_ms":{"type":"number","title":"Total Time Ms"}},"type":"object","required":["success","tenant_cached","user_cached","system_prompt_cached","cache_source","total_time_ms"],"title":"WarmupResponse","description":"Cache warmup results."},"WorkflowExecutionResponse":{"properties":{"execution_id":{"type":"string","format":"uuid","title":"Execution Id"},"session_id":{"type":"string","format":"uuid","title":"Session Id"},"tenant_id":{"type":"integer","title":"Tenant Id"},"user_id":{"type":"integer","title":"User Id"},"query":{"type":"string","title":"Query"},"query_rewritten":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Query Rewritten"},"query_intent":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Query Intent"},"started_at":{"type":"string","format":"date-time","title":"Started At"},"completed_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Completed At"},"duration_ms":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Duration Ms"},"status":{"type":"string","title":"Status"},"final_answer":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Final Answer"},"error_message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error Message"},"total_nodes_executed":{"type":"integer","title":"Total Nodes Executed","default":0},"iteration_count":{"type":"integer","title":"Iteration Count","default":0},"reflection_count":{"type":"integer","title":"Reflection Count","default":0},"tools_called":{"anyOf":[{"items":{"additionalProperties":true,"type":"object"},"type":"array"},{"type":"null"}],"title":"Tools Called"},"llm_tokens_total":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Llm Tokens Total"},"llm_cost_usd":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Llm Cost Usd"},"request_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Request Id"},"trace_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Trace Id"},"final_state":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Final State"}},"type":"object","required":["execution_id","session_id","tenant_id","user_id","query","started_at","status"],"title":"WorkflowExecutionResponse","description":"Complete workflow execution details."}}}}