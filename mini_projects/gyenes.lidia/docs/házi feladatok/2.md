# ==================================================
## ========== RAG √©s LLM kommunik√°ci√≥ ==============
# ==================================================
## Egyel≈ëre csak az IT √©s marketing domainek "√©lnek" a t√∂bbi domainre mock v√°laasz j√∂n

# ----------- Request JSON (p√©lda - marketing domain) -------------------
{
  "user_id": "demo_user",
  "session_id": "demo_session",
  "query": "milyen sz√≠nek megengedettek?"
}

# ----------- Response JSON (v2.6 - marketing domain) ------------------
{
  "domain": "marketing",
  "answer_length": 800,  # ‚úÖ v2.6: R√©szletesebb v√°lasz mem√≥ria + kontextus kiterjeszt√©s√©vel
  "citation_count": 2,   # ‚úÖ v2.6: Deduplik√°lt (5 ‚Üí 2)
  "citation_dedup": "SHA256-based message dedup",
  "memory_features": "rolling_window (8 msg), summary, facts",
  "latency_ms": 2400,    # ‚úÖ v2.6: ~2.4s (embedding cache + Qdrant + LLM)
  "workflow_triggered": false
}

# ---------- RAG context (v2.6 - marketing domain) ---------------------
# ‚úÖ V2.6 EL≈êTT: 5 duplic√°lt dokumentum (PDF + DOCX verzi√≥)
# ‚úÖ V2.6 UT√ÅN: 
#   - Deduplik√°lva (SHA256-hash): csak 1-2 unique dokumentum
#   - Embedding cache (Redis L2): embedding regener√°l√°s kiv√°lt√°sa
#   - Memory augmentation: query + top 3 fact-b≈ël augment√°lva
#   - Feedback boost: user like/dislike alapj√°n score m√≥dos√≠tott

[Doc 1: Aurora_Digital_Arculati_Kezikonyv_HU.pdf] 
Score: 0.95 (alap√©rt√©k: 0.93 + 0.02 feedback boost az 85% like ar√°nyb√≥l)
Egy√©rtelm≈± √°ll√≠t√°sok el≈ënyben r√©szes√≠t√©se.  
4. Log√≥haszn√°lat  
A log√≥ ar√°nyai nem torz√≠that√≥k.  
Minim√°lis v√©d≈ët√°vols√°g: a log√≥ 'A' bet≈±j√©nek magass√°ga.  
Tilos a log√≥ √°tsz√≠nez√©se, forgat√°sa vagy effektez√©se.  
Prefer√°lt elhelyez√©s: bal fels≈ë sarok vagy k√∂z√©pre igaz√≠tva.  
5. Sz√≠npaletta  
Els≈ëdleges sz√≠n: √âjk√©k (#0B1C2D)  
M√°sodlagos sz√≠n: Aurora t√ºrkiz (#1FA6A3)
Kieg√©sz√≠t≈ë sz√≠n: Vil√°gossz√ºrke (#E6E8EB)  
Hiba / figyelmeztet√©s: Jelz≈ëpiros (#C0392B)  
A sz√≠nek k√∂vetkezetes, visszafogott haszn√°lata k√∂telez≈ë...

[Doc 2: Aurora_Digital_Arculati_Kezikonyv_HU.pdf (Page 2)] 
Score: 0.88 (alap√©rt√©k: 0.87 + 0.01 feedback boost)
6. Tipogr√°fia  
Els≈ëdleges bet≈±t√≠pus: Inter (Regular, Medium, SemiBold)  
Alternat√≠v bet≈±t√≠pusok: Arial, Helvetica, sans-serif  
C√≠msorok: SemiBold  
T√∂rzssz√∂veg: Regular  
Dekorat√≠v bet≈±t√≠pusok haszn√°lata nem megengedett.  
7. Elrendez√©s √©s t√©rk√∂z  
Megfelel≈ë mennyis√©g≈± √ºres t√©r alkalmaz√°sa.  
R√°csszerkezethez igaz√≠tott elrendez√©s.  
F√ºgg≈ëleges ritmus el≈ënyben r√©szes√≠t√©se.  
Maxim√°lis sorhossz: 70‚Äì80 karakter...

# ------------ LLM Prompt (v2.6 - marketing domain) --------------------
# ‚úÖ V2.6 M√ìDOS√çT√ÅSok:
# - Memory block hozz√°adva: conversation summary + top 5 fact-b≈ël
# - Domain-specifikus instrukci√≥ik: IT (section ID, Jira), Marketing (arculat), HR (szabads√°g), stb.
# - Telemetry: RAG context, prompt, response logolva
# - Token limit v√©delem: 128k context check, ha t√∫lm√©retes ‚Üí top 3 doc-ra sz≈±k√≠t√©s

You are a helpful HR/IT/Finance/Legal/Marketing assistant.

Conversation summary (mem√≥ria):
[Ha volt t√∂bb kor√°bbi √ºzenet, itt jelenik meg az LLM √°ltal szintetiz√°lt 3-4 mondatos √∂sszefoglal√°s]

Known facts (mem√≥ria):
[Kor√°bbi besz√©lget√©sb≈ël kinyert atomi t√©nyek, max 5, bullet format]

Retrieved documents (use ALL relevant information):
[Document 1: Aurora_Digital_Arculati_Kezikonyv_HU.pdf]
Egy√©rtelm≈± √°ll√≠t√°sok el≈ënyben r√©szes√≠t√©se...
5. Sz√≠npaletta  
Els≈ëdleges sz√≠n: √âjk√©k (#0B1C2D)  
M√°sodlagos sz√≠n: Aurora t√ºrkiz (#1FA6A3)

[Document 2: Aurora_Digital_Arculati_Kezikonyv_HU.pdf]
6. Tipogr√°fia  
Els≈ëdleges bet≈±t√≠pus: Inter (Regular, Medium, SemiBold)  
Alternat√≠v bet≈±t√≠pusok: Arial, Helvetica, sans-serif

User query: "milyen szinek megengedetek?"

Provide a comprehensive answer based on the retrieved documents above.
Combine information from multiple sources when they relate to the same topic.
If asking about guidelines or rules, include ALL relevant details found in the documents.
Use proper formatting with line breaks and bullet points for better readability.
Answer in Hungarian if the query is in Hungarian, otherwise in English.  
9. Helyes √©s helytelen haszn√°lat  
HELYES: Egys√©ges sz√≠nhaszn√°lat.  
HELYES: Letisztult megfogalmaz√°s.  
HELYTELEN: Akcentussz√≠nek t√∫lhaszn√°lata.  
HELYTELEN: Inform√°lis vagy szleng kifejez√©sek.  
10. Tulajdonjog √©s...

User query: "milyen sz√≠nek megengedettek?"

Provide a comprehensive answer based on the retrieved documents above.
Combine information from multiple sources when they relate to the same topic.
If asking about guidelines or rules, include ALL relevant details found in the documents.
Use proper formatting with line breaks and bullet points for better readability.
Answer in Hungarian if the query is in Hungarian, otherwise in English.

# ------------ LLM Response (p√©lda - marketing domain) --------------------
A megengedett sz√≠nek az "Aurora Digital" arculati k√©zik√∂nyv alapj√°n a k√∂vetkez≈ëk:

### Sz√≠npaletta
- **Els≈ëdleges sz√≠n**: 
  - √âjk√©k (#0B1C2D)
  
- **M√°sodlagos sz√≠n**: 
  - Aurora t√ºrkiz (#1FA6A3)

- **Kieg√©sz√≠t≈ë sz√≠n**: 
  - Vil√°gossz√ºrke (#E6E8EB)

- **Hiba / figyelmeztet√©s sz√≠n**: 
  - Jelz≈ëpiros (#C0392B)

### Haszn√°lati ir√°nyelvek
- A sz√≠nek k√∂vetkezetes √©s visszafogott haszn√°lata k√∂telez≈ë.
- Az akcentussz√≠nek t√∫lhaszn√°lata **HELYTELEN**.
- A vizu√°lis elemeknek t√°mogathatj√°k a tartalmat, ker√ºlj√ºk a t√∫lzottan r√©szletes grafik√°kat.

Ez√©rt a megadott sz√≠nek haszn√°lata mellett fontos a sz√≠nkombin√°ci√≥k k√∂vetkezetess√©ge √©s a t√∫lzott sz√≠nhaszn√°lat elker√ºl√©se.

# ===========================================================================
# ========== LLM √©s RAG pontoss√°got √©s hat√©konys√°got jav√≠t√≥ int√©zked√©sek
# ===========================================================================

LLM/RAG Funkcionalit√°sok - Pontoss√°g & Hat√©konys√°g
üéØ Pontoss√°g jav√≠t√°sa
Section ID hivatkoz√°sok (IT domain)

Confluence IT Policy szakaszokat [IT-KB-234] form√°tumban indexelunk
LLM prompt-ba be√©p√≠tett utas√≠t√°s: csak val√≥s section ID-kat haszn√°ljon
Fallback: ha LLM elfelejti, szerz≈ës√©gi l√°nc automatikusan hozz√°adja
Domain-specifikus instrukci√≥ik

IT: l√©p√©senk√©nti hibaelh√°r√≠t√°s + section ID hivatkoz√°sok + Jira ticket aj√°nl√°s
Marketing: arculati k√©zik√∂nyv szab√°lyok betart√°sa, vizu√°lis konzisztencia
HR/Finance/Legal: saj√°t szakter√ºlet-specifikus promptok
Feedback-s√∫lyozott rangsorol√°s

User Like/Dislike visszajelz√©sek ‚Üí Citation score boost/penalty
Magasabb quality tartalom el≈ëbbre ker√ºl a k√∂vetkez≈ë lek√©rdez√©sn√©l
Dinamikus tanul√°s: rossz v√°laszok dem√≥t√°l√≥dnak (-20%), j√≥ v√°laszok feler≈ës√∂dnek (+30%)
Tartalom-alap√∫ deduplik√°ci√≥

PDF/DOCX ugyanazon dokumentum t√∂bbsz√∂r√∂s indexel√©s√©b≈ël v√°lt
Tiszt√°bb LLM context (kevesebb ism√©tl√©s = jobb min≈ës√©g)
‚ö° Hat√©konys√°g jav√≠t√°sa
3-r√©teg≈± Redis cache

L1: Query result cache (teljes v√°lasz) - leggyorsabb
L2: Embedding cache - embedding gener√°l√°s kiv√°lt√°sa
L3: Direct document fetch by ID - Qdrant keres√©s kiv√°lt√°sa
Lexikai overlap reranking (IT)

Query tokent√∂lt√∂bb (3+ karakter) alapj√°n boost relevancia
0-20% score boost a tartalmi egyez√©s alapj√°n
Nem hardcoded: minden IT t√©m√°hoz m≈±k√∂dik generikusan
Batch feedback fetch

√ñsszes citation feedback egy SQL lek√©rdez√©sben
Connection pool v√©delme, N+1 query elker√ºl√©se
Token limit v√©delem

Prompt m√©ret check el≈ëtte: gpt-4o-mini 128k context
Ha t√∫lm√©retes: top 3 doc-ra sz≈±k√≠t√©s + retry
Timeout elker√ºl√©s
Domain filter Qdrant-ban

Csak relev√°ns domain dokumentumai keres√©se
Felesleges atravesz√°l√°s kik√ºsz√∂b√∂l√©se
Structured RAG context telemetria

RAG context, LLM prompt, LLM response logol√°sa
Debug panel: transzparens insight a d√∂nt√©sekbe
Citation tracking: mely dokik befoly√°solt√°k a v√°laszt

# ===========================================================================
# ========== UNIT Tesztek el√©r√©se
# ===========================================================================

backend\tests